<!DOCTYPE html>
<html>
<head>
<title>OMR Capture</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
#wrap{position:relative;width:300px}
#box{
 position:absolute;
 border:3px solid lime;
 top:15%;
 left:15%;
 width:70%;
 height:70%;
 pointer-events:none;
}
</style>

</head>

<body>

<h3>Place OMR inside box</h3>

<div id="wrap">
<video id="video" autoplay playsinline width="300"></video>
<div id="box"></div>
</div>

<br>
<button onclick="capture()">Capture</button>

<canvas id="canvas" style="display:none"></canvas>

<br><br>
<img id="result" width="300"/>

<script>
const video=document.getElementById("video");

navigator.mediaDevices.getUserMedia({
  video: { facingMode: { exact: "environment" } }
})

.then(s=>video.srcObject=s);

function capture(){
 const c=document.getElementById("canvas");
 c.width=video.videoWidth;
 c.height=video.videoHeight;
 c.getContext("2d").drawImage(video,0,0);

 c.toBlob(b=>{
   let f=new FormData();
   f.append("image",b,"cam.jpg");

   fetch("/process",{method:"POST",body:f})
   .then(r=>r.blob())
   .then(img=>{
     document.getElementById("result").src=
       URL.createObjectURL(img);
   });
 });
}
</script>

</body>
</html>

